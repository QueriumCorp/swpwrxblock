<div id="root"></div>

<!-- ### START OF STEPWISE STUFF ### -->
<!-- The following div holds the SW component off screen -->
<div id="swBackStage" style="position: fixed; left: -10000px">
      <!-- when the student navs to the StepWise page to work the problem, we reparent
      the #swClient into the page -->
      <div id="swClient" style="position: relative; flex-grow:2;">
          <querium
            label="QUES-6011"
            description="Solve by addition.  \(\begin{array}{c}7x-2y=3 \\4x+5y=3.25\end{array}\)"
            definition="SolveFor[7x-2y=3 && 4x+5y=3.25, {x,y}, EliminationMethod]"
            mathml="\(\)"
            type="gradeBasicAlgebra"
            hint1=""
            hint2=""
            hint3=""
          ></querium>
      </div>
    </div>

    <!-- Just hiding the test page widgets so I don't have to spend time
    detangling them -->
    <div id="swClientControls" style="display: none">
      <p>
        Your question will be running on version 1.6.8.1 of the StepWise Client
        (1.6.6 + Firebase + log button fixes).
      </p>

      <p></p>
      <p>
        <label for="author">Author:</label>
        <input id="author" />&nbsp;
        <button onclick="saveTest()">Save Author Name</button>
      </p>
      <p>
        <label for="server">StepWiseAI Server:</label>
        <input id="server" style="width: 400px" />&nbsp;
        <button onclick="setServer()">Set</button>
      </p>
      <ul>
        <li>https://stepwisedev.querium.com/webMathematica/api/</li>
        <li>https://stepwise.querium.com/webMathematica/api/</li>
        <li>https://stepwiseai.querium.com/webMathematica/api/</li>
        <li>https://stepwiseai00.querium.com/webMathematica/api/</li>
        <li>https://stepwiseai01.querium.com/webMathematica/api/</li>
        <li>https://stepwiseai02.querium.com/webMathematica/api/</li>
        <li>https://stepwiseai03.querium.com/webMathematica/api/</li>
        <li>https://stepwiseai04.querium.com/webMathematica/api/</li>
      </ul>
    </div>
    <script type="text/javascript">
      var qqUser =
        localStorage.getItem("name") == null ||
        localStorage.getItem("name").length === 0
          ? "SW4WP User"
          : localStorage.getItem("name");
      var server =
        localStorage.getItem("server") == null ||
        localStorage.getItem("server").length === 0
          ? "https://stepwise.querium.com/webMathematica/api/"
          : localStorage.getItem("server");
      var questionList = [];
      var urlParams = getJsonFromUrl(true);
      var problemID = urlParams.assignment_id;
      var theProblem = false;

      window.onload = function () {
        document.getElementById("author").value = qqUser;
        document.getElementById("server").value = server;
        querium.serverURL = server;
      };

      document.getElementById("author").onblur = function (e) {
        var author = document.getElementById("author").value;
        if (author.length > 2) {
          localStorage.setItem("name", author);
        }
      };
      document.getElementById("author").onkeypress = function (e) {
        var event = e || window.event;
        var charCode = event.which || event.keyCode;

        if (charCode == "13") {
          var author = document.getElementById("author").value;
          if (author.length > 2) {
            localStorage.setItem("name", author);
          }
          return false;
        }
      };
      document.getElementById("server").onblur = function (e) {
        var server = document.getElementById("server").value;
        localStorage.setItem("server", server);
        querium.serverURL = server;
      };
      document.getElementById("server").onkeypress = function (e) {
        var event = e || window.event;
        var charCode = event.which || event.keyCode;

        if (charCode == "13") {
          var server = document.getElementById("server").value;
          localStorage.setItem("server", server);
          querium.serverURL = server;
          return false;
        }
      };

      function saveTest() {
        var author = document.getElementById("author").value;
        if (author.length > 2) {
          localStorage.setItem("name", author);
          var state = querium.saveState("querium");
          state.problemDef = state.problemDef.replace(/^"(.+(?="$))"$/, "$1");
          /* testRef.push({
                      problemID: problemID,
                      author: author,
                      log: JSON.stringify(state)
                  }); 
                  alert('Test saved');
          */
          alert("Name saved");
        } else {
          alert("Who am I?  Why am I here?");
        }
      }

      function setServer() {
        var server = document.getElementById("server").value;
        localStorage.setItem("server", server);
        querium.serverURL = server;
        alert("Server changed to " + server);
      }

      function getJsonFromUrl(hashBased) {
        var query;
        if (hashBased) {
          var pos = location.href.indexOf("?");
          if (pos == -1) return [];
          query = location.href.substr(pos + 1);
        } else {
          query = location.search.substr(1);
        }
        var result = {};
        query.split("&").forEach(function (part) {
          if (!part) return;
          var item = part.split("=");
          var key = item[0];
          var from = key.indexOf("[");
          if (from == -1) result[key] = decodeURIComponent(item[1]);
          else {
            var to = key.indexOf("]");
            var index = key.substring(from + 1, to);
            key = key.substring(0, from);
            if (!result[key]) result[key] = [];
            if (!index) result[key].push(item[1]);
            else result[key][index] = item[1];
          }
        });
        return result;
      }
    </script>

    <script type="text/javascript">
      var callbacks = {
        success: celebrate,
        status: updateProgress,
      };

      var options = {
        hideMenu: true,
        scribbles: false,
      };

      function saveProgress() {
        console.dir(querium.saveState());
      }

      function celebrate(stats) {
        console.log("celebrating victory in webApp");
        console.dir(stats);
        alert("Victory is OURS!");
        var btnElement = document.querySelector("#endOfSW");
        console.log("btnElement = ", btnElement);
        var classValues = btnElement.classList;
        console.log("classValues = ", classValues);
        btnElement.classList.remove(
          "ui-disabled"
        ); /* Enable next question button after StepWise */
        setCorrect(); /* This counts as a correct question */
        updateCorrect(); /* increase the number of stars */
        showCorrect(); /* Update the stars right now */
      }

      function updateProgress(stats) {
        console.log("updatingProgress in webApp");
        console.dir(stats);
      }

      querium.appID = "JiraTestPage";
      querium.student = qqUser;
      console.log("querium.student = " + querium.student);
      querium.callbacks = {
        success: celebrate,
      };
      querium.options = options;
    </script>
    <div class="swpwrxblock_block" data-ng-strict-di>
      <div class='stepwise_container'>

        <div class='loading-box'>
            <div class="loading-info">
                 <span class="loading-val">Loading Data...</span>
            </div>
        </div>

        <div class='question-info'>
            <div class="grade-box">
                 <span class="grade-val">(3.00/3.00 points)</span>
            </div>

            <div class="made-attempts-box">
                <div class="made-attempts">
                    <div>3 of 3 attempts</div>
                </div>
            </div>

            <div class="min-steps-box">
                <div class="min-steps">
                    <div>33 minimum steps</div>
                </div>
            </div>

            <div class="too-many-attempts-box">
                <div class="too-many-attempts">
                     <p class="too-many-attempts">You&apos;ve used all your attempts on this question.</p>
                </div>
            </div>
        </div>

        <div class='click-to-begin-box'>
            <div class="click-to-begin">
                <p class="click-to-begin">Click the problem text below to solve this step-by-step question:</p>
            </div>
        </div>

        <querium style='display: none;'></querium>

        <div class='qq_preview0 preview_hidden'>
            <h3 class="hd hd-3 problem-header">{self.q_label}</h3>
            <div class='practice-problem'>
                <p class='stimulus'>{self.q_stimulus}</p>
                <p class='display-math'>{self.q_display_math}</p>
            </div>
        </div>
        <div class='stepwise-retry'>
           <button type="button" class="retry problem-action-btn btn-default btn-small" data-value="Retry">
              <span class="icon fa fa-refresh" aria-hidden="false">
                 <!-- :before css adds fontawsome icon -->
              </span>
              <span aria-hidden="false">Retry</span>
           </button>
           <div class='stepwise-retry-variants-box'>
              <p class='stepwise-retry-variants'>(3 variants)</p>
           </div>
        </div>

        <div class='question-stats preview_hidden'>
            <div class="star-box preview_hidden">
                <span class="star1 star-icon">☆</span>
                <span class="star2 star-icon">☆</span>
                <span class="star3 star-icon">☆</span>
            </div>
    
            <div class="time-box">
                <div class="step-icon elapsed-time"></div>
                <span class="elapsed-time-count">33</span><span>s</span>
            </div>
    
            <div class="error-count-box">
                <div class="step-icon invalid-step"></div>
                <span class="error-count">3</span>
            </div>
    
            <div class="hint-count-box">
                <div class="step-icon hint-request"></div>
                <span class="hint-count">3</span>
            </div>

            <div class="used-showme">
                <div>Used Show Solution</div>
            </div>   
        </div>

        <div class="solution preview_hidden">
        </div>
    </div>
</div>
